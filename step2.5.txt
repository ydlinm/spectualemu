Prompt for AI Coding AssistantRole: You are a Computational Imaging Algorithm Engineer.Task: Implement Step 2 (Advanced): Multi-Point Source Illumination & Skin Interaction for the SSS simulation pipeline.Goal: Generate a Hyperspectral Cube representing the skin response to a Sparse Dot Array (Multi-Pore Mask), correctly modeling the non-uniform illumination field and the superposition of Point Spread Functions (PSF).Inputs:SpectralAssets (from Step 1: $\mu_a, \mu_s', S(\lambda)$).skin_texture.png (Surface reflectance map).Optical Constraints:Fiber Output: $\phi = 8mm$ circular face.Projection Lens: $f = 25mm$.Magnification: Assume system magnification $M \approx 1.0$ for simplicity (projection 1:1 onto skin).Mask Pattern: A defined sparse array (e.g., a $7 \times 7$ grid with specific pitch).Requirements & Implementation Logic:1. Generate the Multi-Pore Mask Geometry:Create a binary mask $M(x,y)$ representing the pinhole locations.Parameterize: Allow defining grid_shape=(7, 7) and pitch_pixels (distance between points).Coordinates: Generate a list of center coordinates $[(x_1, y_1), (x_2, y_2), ...]$ for all valid pinholes.2. Model the Beam Intensity Profile (The "Vignetting" Effect):The light source is NOT uniform. It follows the fiber bundle's output profile.Physics Model: Create a 2D intensity map $I_{beam}(x,y)$ that:Is 1.0 at the optical axis (center).Falls off according to a Gaussian or Super-Gaussian profile to simulate the fiber's Numerical Aperture (NA) limit.Constraint: Ensure the intensity drops to ~50% or ~0% at radius $r = 4mm$ (matching the 8mm fiber diameter).Action: Assign a specific intensity weight $w_i$ to each pinhole based on its location: $w_i = I_{beam}(x_i, y_i)$. Points at the edge should be dimmer.3. The Dual-PSF Interaction Engine (The Core Loop):Iterate through each pinhole $(x_i, y_i)$ and calculate its contribution to the scene. Do NOT use simple convolution (which assumes shift-invariance); use "Splatting" (Superposition) to handle spatially varying textures.A. Surface PSF ($S^2$ - The "Sharp" Component):Model: A narrow Gaussian ($\sigma_{surf} \approx 1-2$ pixels) representing the projection lens resolution.Intensity: $I_{surf} = w_i \cdot S(\lambda) \cdot \text{Texture}(x_i, y_i) \cdot \alpha_{Fresnel}$.Note: This spot is sharp and carries the surface texture information.B. Subsurface PSF ($S^4$ - The "Diffuse" Component):Model: The Farrell Dipole Diffusion Kernel $R_d(r, \lambda)$.Physics Check: The kernel shape depends on $\mu_a(\lambda)$ and $\mu_s'(\lambda)$ (from Step 1). It changes size with wavelength.Intensity: $I_{sub} = w_i \cdot S(\lambda) \cdot R_d(r)$.Note: This spot is wide and diffuse.C. Superposition (Accumulation):Add both $I_{surf}$ and $I_{sub}$ to the global Hyperspectral_Scene_Buffer.Crucial: Allow overlapping! If two points are close, their diffuse tails ($S^4$) should sum up linearly.4. Simulation Output:Return Scene_HyperCube: A 3D array [H, W, Wavelengths] containing the total light field leaving the skin surface.5. Visualization & Sanity Check:Plot a cross-section of the generated light field at a specific wavelength (e.g., 1000nm).Check: Verify that center points are brighter than edge points (Beam Profile effect).Check: Verify that Surface PSF is a peak and Subsurface PSF is a tail.